<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winter Corporate Foosball</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#D4AF37',
                        'deep-red': '#8B0000',
                        'void-black': '#050505',
                        'glass': 'rgba(255, 255, 255, 0.05)'
                    },
                    fontFamily: {
                        sans: ['Helvetica Neue', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { margin: 0; overflow-x: hidden; background-color: #000; color: white; }
        
        /* 3D Canvas Background */
        #canvas-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, #1a0505 0%, #000000 100%);
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.2); /* Gold border */
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .glass-nav {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #D4AF37; border-radius: 4px; }

        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .gold-glow { text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }
    </style>
</head>
<body class="font-sans antialiased text-gray-200">

    <div id="canvas-container"></div>

    <nav class="fixed top-0 w-full z-50 glass-nav h-16 flex items-center justify-between px-4 lg:px-8">
        <div class="flex items-center gap-2">
            <i class="fas fa-snowflake text-gold animate-pulse"></i>
            <span class="font-bold text-xl tracking-wider text-white">WINTER <span class="text-gold">CUP</span></span>
        </div>
        
        <div class="hidden md:flex gap-6 text-sm uppercase tracking-widest">
            <button onclick="navTo('welcome')" class="hover:text-gold transition-colors duration-300">Home</button>
            <button onclick="navTo('tabella')" class="hover:text-gold transition-colors duration-300">Tabella</button>
            <button onclick="navTo('meccsek')" class="hover:text-gold transition-colors duration-300">Meccsek</button>
            <button onclick="navTo('szabalyok')" class="hover:text-gold transition-colors duration-300">Szabályok</button>
        </div>

        <button onclick="openAdminModal()" class="border border-gold text-gold px-4 py-1 rounded hover:bg-gold hover:text-black transition duration-300 text-xs uppercase font-bold">
            Admin Belépés
        </button>
    </nav>

    <div class="md:hidden fixed bottom-0 w-full glass-nav z-50 flex justify-around py-3 text-xs uppercase">
        <button onclick="navTo('tabella')" class="flex flex-col items-center gap-1 text-gold"><i class="fas fa-list-ol"></i> Tabella</button>
        <button onclick="navTo('meccsek')" class="flex flex-col items-center gap-1 text-gold"><i class="fas fa-futbol"></i> Meccsek</button>
        <button onclick="navTo('szabalyok')" class="flex flex-col items-center gap-1 text-gold"><i class="fas fa-book"></i> Szabályok</button>
    </div>

    <main class="pt-24 pb-20 px-4 max-w-6xl mx-auto min-h-screen">
        
        <section id="welcome" class="fade-in text-center py-20">
            <h1 class="text-5xl md:text-7xl font-bold mb-4 gold-glow text-white">TÉLI CSOCSÓ KUPA</h1>
            <p class="text-xl text-gray-300 mb-8">Üdvözlünk a vállalati bajnokságon!</p>
            <div class="inline-block glass-panel p-6 rounded-lg">
                <p class="text-gold uppercase text-sm tracking-widest mb-2">Következő Meccs</p>
                <div id="next-match-display" class="text-2xl font-bold">Jelenleg nincs aktív meccs</div>
            </div>
        </section>

        <section id="tabella" class="hidden fade-in">
            <h2 class="text-3xl font-bold text-gold mb-6 border-b border-gray-700 pb-2">Tabella</h2>
            <div class="glass-panel rounded-xl overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-black/40 text-gold uppercase text-xs tracking-wider">
                            <th class="p-4">#</th>
                            <th class="p-4">Csapat</th>
                            <th class="p-4 text-center">M</th>
                            <th class="p-4 text-center">Gy</th>
                            <th class="p-4 text-center">D</th>
                            <th class="p-4 text-center">V</th>
                            <th class="p-4 text-right">Pont</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="meccsek" class="hidden fade-in">
            <h2 class="text-3xl font-bold text-gold mb-6 border-b border-gray-700 pb-2">Mérkőzések</h2>
            
            <div id="finals-container" class="mb-8 hidden">
                <h3 class="text-xl text-deep-red font-bold mb-4 uppercase tracking-widest">Döntők</h3>
                <div class="grid md:grid-cols-2 gap-4" id="finals-list"></div>
            </div>

            <h3 class="text-xl text-gray-400 font-bold mb-4 uppercase tracking-widest">Körmérkőzések</h3>
            <div class="grid md:grid-cols-1 gap-3" id="matches-list">
                </div>
        </section>

        <section id="szabalyok" class="hidden fade-in">
            <h2 class="text-3xl font-bold text-gold mb-6 border-b border-gray-700 pb-2">Szabályok</h2>
            <div class="glass-panel p-8 rounded-xl">
                <ul id="rules-list" class="space-y-4 list-disc list-inside text-lg text-gray-300">
                    </ul>
            </div>
        </section>

    </main>

    <div id="admin-modal" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/90 backdrop-blur-sm">
        <div class="glass-panel w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-xl p-6 m-4 relative">
            <button onclick="closeAdminModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white"><i class="fas fa-times fa-lg"></i></button>
            
            <h2 class="text-2xl font-bold text-gold mb-6">Adminisztráció</h2>

            <div id="admin-login-view">
                <input type="password" id="admin-pass" placeholder="Jelszó" class="w-full bg-black/50 border border-gray-700 rounded p-3 text-white mb-4 focus:border-gold outline-none">
                <button onclick="adminLogin()" class="w-full bg-gold text-black font-bold py-3 rounded hover:bg-yellow-500 transition">Belépés</button>
                <p id="login-error" class="text-red-500 mt-2 text-sm hidden">Helytelen jelszó!</p>
            </div>

            <div id="admin-dashboard-view" class="hidden space-y-8">
                
                <div class="border border-gray-700 p-4 rounded bg-black/30">
                    <h3 class="text-lg font-bold text-white mb-2">1. Csapatok Generálása</h3>
                    <textarea id="player-input" rows="4" class="w-full bg-black/50 border border-gray-600 rounded p-2 text-sm text-gray-300 mb-2" placeholder="Illeszd be a neveket (soronként 1 név)..."></textarea>
                    <button onclick="generateTournament()" class="bg-deep-red text-white px-4 py-2 rounded text-sm hover:bg-red-700 w-full">Generálás (Sorsolás + Nevek)</button>
                    <p class="text-xs text-gray-500 mt-1">Figyelem: Ez törli a jelenlegi állást!</p>
                </div>

                <div class="border border-gray-700 p-4 rounded bg-black/30">
                    <h3 class="text-lg font-bold text-white mb-2">2. Eredmények Rögzítése</h3>
                    <div id="admin-match-list" class="space-y-2 max-h-60 overflow-y-auto pr-2">
                        </div>
                </div>

                <div class="border border-gray-700 p-4 rounded bg-black/30">
                    <h3 class="text-lg font-bold text-white mb-2">3. Szabályok Szerkesztése</h3>
                    <div class="flex gap-2">
                        <input type="text" id="new-rule-input" class="flex-1 bg-black/50 border border-gray-600 rounded p-2 text-sm" placeholder="Új szabály...">
                        <button onclick="addRule()" class="bg-gray-700 px-3 rounded hover:bg-gray-600"><i class="fas fa-plus"></i></button>
                    </div>
                    <ul id="admin-rules-list" class="mt-4 space-y-2 text-sm text-gray-400"></ul>
                </div>

                <div class="flex justify-end gap-2 pt-4 border-t border-gray-700">
                    <span id="save-status" class="text-green-400 text-sm self-center mr-2 opacity-0 transition-opacity">Mentve!</span>
                    <button onclick="forceSave()" class="bg-gold text-black px-6 py-2 rounded font-bold hover:bg-yellow-500">Adatok Mentése</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        const funnyNames = [
            "Részeg Rénszarvasok", "Beigli Betyárok", "Csendes Éj Harcosai", 
            "Hólapátolók", "Reszkessetek Betörők", "Gingersbread Gengszterek",
            "Forralt Bor Kommandó", "Ajándékvadászok", "Grincs Gárdája", "Szaloncukor Zsoldosok"
        ];
        
        // Initial State
        let state = {
            teams: [],
            matches: [],
            rules: ["A pörgetés tilos (No spinning).", "Fair play mindenek felett.", "Gól után középkezdés.", "Az első 10 gólig tart a meccs."],
            generated: false
        };

        // --- FIREBASE CONFIGURATION ---
        // To enable Firebase, uncomment and fill in your details:
        /*
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        */

        // Hybrid Data Sync Engine
        function loadData() {
            // 1. Try LocalStorage first for instant load
            const local = localStorage.getItem('foosball_data');
            if (local) {
                state = JSON.parse(local);
                renderAll();
            }

            // 2. Try Firebase (if configured)
            if (typeof db !== 'undefined') {
                db.ref('tournament').on('value', (snapshot) => {
                    const cloudData = snapshot.val();
                    if (cloudData) {
                        state = cloudData;
                        renderAll(); // Re-render with authoritative cloud data
                        localStorage.setItem('foosball_data', JSON.stringify(state)); // Update local cache
                    }
                });
            }
        }

        function saveData() {
            // Optimistic UI Update
            renderAll();
            
            // Save Local
            localStorage.setItem('foosball_data', JSON.stringify(state));

            // Save Cloud
            if (typeof db !== 'undefined') {
                db.ref('tournament').set(state).catch(e => console.error("Cloud sync failed", e));
            }

            // Visual Feedback
            const statusEl = document.getElementById('save-status');
            statusEl.style.opacity = '1';
            setTimeout(() => statusEl.style.opacity = '0', 2000);
        }

        // --- CORE LOGIC ---

        function generateTournament() {
            const rawText = document.getElementById('player-input').value.trim();
            if (!rawText) return alert("Kérlek adj meg neveket!");

            let players = rawText.split('\n').filter(n => n.trim().length > 0);
            
            // Shuffle players (Fisher-Yates)
            for (let i = players.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [players[i], players[j]] = [players[j], players[i]];
            }

            // Create Teams
            const teams = [];
            const shuffledNames = [...funnyNames].sort(() => 0.5 - Math.random());
            
            let pIndex = 0;
            let teamId = 1;

            while (pIndex < players.length) {
                let teamName = shuffledNames[teamId - 1] || `Csapat ${teamId}`;
                let members = [];
                
                if (players.length - pIndex === 1) {
                    // Handle odd number
                    members = [players[pIndex], "VÁRAKOZÓ (Gép/Beugró)"];
                    pIndex++;
                } else {
                    members = [players[pIndex], players[pIndex + 1]];
                    pIndex += 2;
                }

                teams.push({
                    id: teamId,
                    name: teamName,
                    members: members,
                    stats: { played: 0, w: 0, d: 0, l: 0, pts: 0, gf: 0, ga: 0 } // gf: goals for, ga: goals against
                });
                teamId++;
            }

            // Generate Schedule (Round Robin)
            const matches = [];
            let matchId = 1;

            for (let i = 0; i < teams.length; i++) {
                for (let j = i + 1; j < teams.length; j++) {
                    matches.push({
                        id: matchId++,
                        t1: teams[i].id,
                        t2: teams[j].id,
                        s1: null,
                        s2: null,
                        status: 'scheduled', // scheduled, played
                        type: 'group'
                    });
                }
            }

            // Add Final Placeholders
            matches.push({ id: 998, t1: null, t2: null, s1: null, s2: null, status: 'scheduled', type: 'bronze', label: "Bronzmeccs" });
            matches.push({ id: 999, t1: null, t2: null, s1: null, s2: null, status: 'scheduled', type: 'gold', label: "DÖNTŐ" });

            state.teams = teams;
            state.matches = matches;
            state.generated = true;
            saveData();
            renderAdminDashboard();
        }

        function calculateStandings() {
            // Reset stats
            state.teams.forEach(t => {
                t.stats = { played: 0, w: 0, d: 0, l: 0, pts: 0, gf: 0, ga: 0 };
            });

            // Process matches
            state.matches.filter(m => m.type === 'group' && m.status === 'played').forEach(m => {
                const t1 = state.teams.find(t => t.id === m.t1);
                const t2 = state.teams.find(t => t.id === m.t2);
                
                if(!t1 || !t2) return;

                // Goals
                t1.stats.gf += parseInt(m.s1); t1.stats.ga += parseInt(m.s2);
                t2.stats.gf += parseInt(m.s2); t2.stats.ga += parseInt(m.s1);
                
                t1.stats.played++;
                t2.stats.played++;

                if (m.s1 > m.s2) { // T1 Win
                    t1.stats.w++; t1.stats.pts += 3;
                    t2.stats.l++;
                } else if (m.s2 > m.s1) { // T2 Win
                    t2.stats.w++; t2.stats.pts += 3;
                    t1.stats.l++;
                } else { // Draw
                    t1.stats.d++; t1.stats.pts += 1;
                    t2.stats.d++; t2.stats.pts += 1;
                }
            });

            // Sort: Points > Wins > Goal Difference
            state.teams.sort((a, b) => {
                if (b.stats.pts !== a.stats.pts) return b.stats.pts - a.stats.pts;
                if (b.stats.w !== a.stats.w) return b.stats.w - a.stats.w;
                return (b.stats.gf - b.stats.ga) - (a.stats.gf - a.stats.ga);
            });

            // Update Finals Participants based on ranking
            if (state.teams.length >= 4) {
                const bronzeMatch = state.matches.find(m => m.type === 'bronze');
                const goldMatch = state.matches.find(m => m.type === 'gold');
                
                if (bronzeMatch && bronzeMatch.status !== 'played') {
                    bronzeMatch.t1 = state.teams[2].id;
                    bronzeMatch.t2 = state.teams[3].id;
                }
                if (goldMatch && goldMatch.status !== 'played') {
                    goldMatch.t1 = state.teams[0].id;
                    goldMatch.t2 = state.teams[1].id;
                }
            }
        }

        // --- RENDERING ---

        function renderAll() {
            calculateStandings();
            renderStandings();
            renderMatches();
            renderRules();
            renderAdminMatches(); // If admin is open
        }

        function renderStandings() {
            const tbody = document.getElementById('standings-body');
            tbody.innerHTML = '';
            
            state.teams.forEach((t, index) => {
                const tr = document.createElement('tr');
                tr.className = index < 3 ? 'bg-gold/10 border-b border-gray-800' : 'border-b border-gray-800 hover:bg-white/5 transition';
                tr.innerHTML = `
                    <td class="p-4 font-bold ${index === 0 ? 'text-gold' : 'text-gray-400'}">${index + 1}.</td>
                    <td class="p-4">
                        <div class="font-bold text-white">${t.name}</div>
                        <div class="text-xs text-gray-500">${t.members.join(' & ')}</div>
                    </td>
                    <td class="p-4 text-center text-gray-400">${t.stats.played}</td>
                    <td class="p-4 text-center text-green-400">${t.stats.w}</td>
                    <td class="p-4 text-center text-gray-400">${t.stats.d}</td>
                    <td class="p-4 text-center text-red-400">${t.stats.l}</td>
                    <td class="p-4 text-right font-bold text-gold text-lg">${t.stats.pts}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderMatches() {
            const list = document.getElementById('matches-list');
            const finalsList = document.getElementById('finals-list');
            const finalsContainer = document.getElementById('finals-container');
            list.innerHTML = '';
            finalsList.innerHTML = '';

            let hasFinals = false;

            state.matches.forEach(m => {
                const t1 = state.teams.find(t => t.id === m.t1);
                const t2 = state.teams.find(t => t.id === m.t2);
                
                if (!t1 || !t2) return; // Skip incomplete placeholders

                const cardHTML = `
                    <div class="glass-panel p-4 rounded flex justify-between items-center ${m.status === 'played' ? 'opacity-70' : 'border-l-4 border-gold'}">
                        <div class="flex-1 text-right pr-4">
                            <div class="font-bold text-gray-200">${t1.name}</div>
                        </div>
                        <div class="flex flex-col items-center min-w-[80px]">
                             ${m.status === 'played' 
                                ? `<span class="text-2xl font-bold text-gold">${m.s1} - ${m.s2}</span>`
                                : `<span class="text-xs uppercase bg-gray-800 px-2 py-1 rounded">VS</span>`
                            }
                        </div>
                        <div class="flex-1 text-left pl-4">
                            <div class="font-bold text-gray-200">${t2.name}</div>
                        </div>
                    </div>
                `;

                if (m.type === 'group') {
                    list.innerHTML += cardHTML;
                } else {
                    hasFinals = true;
                    finalsList.innerHTML += `
                        <div class="glass-panel p-4 rounded border border-${m.type === 'gold' ? 'gold' : 'orange-700'} relative overflow-hidden">
                            <div class="absolute top-0 right-0 bg-${m.type === 'gold' ? 'gold' : 'orange-700'} text-black text-xs font-bold px-2 py-1">${m.label}</div>
                            <div class="flex justify-between items-center mt-2">
                                <span class="font-bold text-white">${t1.name}</span>
                                ${m.status === 'played' 
                                    ? `<span class="font-bold text-gold text-xl mx-2">${m.s1} - ${m.s2}</span>` 
                                    : `<span class="text-xs text-gray-500 mx-2">vs</span>`}
                                <span class="font-bold text-white">${t2.name}</span>
                            </div>
                        </div>
                    `;
                }
            });

            if(hasFinals) finalsContainer.classList.remove('hidden');
        }

        function renderRules() {
            const list = document.getElementById('rules-list');
            list.innerHTML = state.rules.map(r => `<li>${r}</li>`).join('');
            
            // Admin side rules
            const adminList = document.getElementById('admin-rules-list');
            adminList.innerHTML = state.rules.map((r, i) => `
                <li class="flex justify-between items-center bg-black/40 p-2 rounded">
                    <span>${r}</span>
                    <button onclick="deleteRule(${i})" class="text-red-500 hover:text-red-400"><i class="fas fa-trash"></i></button>
                </li>
            `).join('');
        }

        function renderAdminMatches() {
            const list = document.getElementById('admin-match-list');
            list.innerHTML = '';
            
            state.matches.forEach(m => {
                const t1 = state.teams.find(t => t.id === m.t1);
                const t2 = state.teams.find(t => t.id === m.t2);
                if (!t1 || !t2) return;

                const div = document.createElement('div');
                div.className = "flex items-center gap-2 bg-black/40 p-2 rounded text-sm";
                div.innerHTML = `
                    <span class="w-8 text-xs text-gray-500">#${m.id}</span>
                    <span class="flex-1 text-right truncate text-gray-300">${t1.name}</span>
                    <input type="number" onchange="updateScore(${m.id}, 's1', this.value)" value="${m.s1 ?? ''}" class="w-10 bg-gray-800 border border-gray-600 rounded text-center text-white" placeholder="0">
                    <span class="text-gray-500">-</span>
                    <input type="number" onchange="updateScore(${m.id}, 's2', this.value)" value="${m.s2 ?? ''}" class="w-10 bg-gray-800 border border-gray-600 rounded text-center text-white" placeholder="0">
                    <span class="flex-1 text-left truncate text-gray-300">${t2.name}</span>
                `;
                list.appendChild(div);
            });
        }

        // --- INTERACTION ---

        function updateScore(matchId, field, value) {
            const match = state.matches.find(m => m.id === matchId);
            if (match) {
                match[field] = value;
                // If both scores present, mark played
                if (match.s1 !== null && match.s1 !== "" && match.s2 !== null && match.s2 !== "") {
                    match.status = 'played';
                } else {
                    match.status = 'scheduled';
                }
            }
        }

        function forceSave() {
            saveData();
        }

        function addRule() {
            const input = document.getElementById('new-rule-input');
            if (input.value.trim()) {
                state.rules.push(input.value.trim());
                input.value = '';
                saveData();
            }
        }

        function deleteRule(index) {
            state.rules.splice(index, 1);
            saveData();
        }

        function navTo(sectionId) {
            ['welcome', 'tabella', 'meccsek', 'szabalyok'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        // Admin Auth
        function openAdminModal() {
            document.getElementById('admin-modal').classList.remove('hidden');
            document.getElementById('admin-modal').classList.add('flex');
        }
        function closeAdminModal() {
            document.getElementById('admin-modal').classList.add('hidden');
            document.getElementById('admin-modal').classList.remove('flex');
        }
        function adminLogin() {
            const pass = document.getElementById('admin-pass').value;
            if (pass === 'Jimmy92') {
                document.getElementById('admin-login-view').classList.add('hidden');
                document.getElementById('admin-dashboard-view').classList.remove('hidden');
                renderAdminDashboard();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        function renderAdminDashboard() {
            renderAdminMatches();
            renderRules();
        }

        // --- THREE.JS BACKGROUND ---
        
        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            
            // Camera
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 15;
            camera.position.y = 10;
            camera.lookAt(0, 0, 0);

            // Renderer
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xd4af37, 1);
            pointLight.position.set(10, 10, 10);
            scene.add(pointLight);

            // Foosball Field (Abstract)
            const fieldGroup = new THREE.Group();
            
            // Green Pitch
            const geometry = new THREE.BoxGeometry(16, 0.5, 10);
            const material = new THREE.MeshStandardMaterial({ color: 0x0f3b1e, roughness: 0.2 });
            const field = new THREE.Mesh(geometry, material);
            fieldGroup.add(field);

            // Lines (White Planes)
            const lineMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.5 });
            const centerLine = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.51, 10), lineMat);
            fieldGroup.add(centerLine);

            const goal1 = new THREE.Mesh(new THREE.BoxGeometry(1, 0.51, 4), new THREE.MeshBasicMaterial({ color: 0x111111 }));
            goal1.position.x = -8;
            fieldGroup.add(goal1);
            
            const goal2 = new THREE.Mesh(new THREE.BoxGeometry(1, 0.51, 4), new THREE.MeshBasicMaterial({ color: 0x111111 }));
            goal2.position.x = 8;
            fieldGroup.add(goal2);

            scene.add(fieldGroup);

            // Snow Particles
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 1000;
            const posArray = new Float32Array(particlesCount * 3);

            for(let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 50;
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.1,
                color: 0xffffff,
                transparent: true,
                opacity: 0.8
            });
            const snowMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(snowMesh);

            // Mouse Interaction
            let mouseX = 0;
            let mouseY = 0;
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX / window.innerWidth) - 0.5;
                mouseY = (event.clientY / window.innerHeight) - 0.5;
            });

            // Animation Loop
            function animate() {
                requestAnimationFrame(animate);

                // Rotate Field slowly
                fieldGroup.rotation.y += 0.002;

                // React to mouse
                camera.position.x += (mouseX * 10 - camera.position.x) * 0.05;
                camera.position.y += (-mouseY * 5 + 10 - camera.position.y) * 0.05;
                camera.lookAt(0, 0, 0);

                // Fall Snow
                const positions = snowMesh.geometry.attributes.position.array;
                for(let i = 1; i < particlesCount * 3; i+=3) {
                    positions[i] -= 0.1; // move y down
                    if (positions[i] < -20) {
                        positions[i] = 20;
                    }
                }
                snowMesh.geometry.attributes.position.needsUpdate = true;

                renderer.render(scene, camera);
            }
            animate();

            // Resize Handle
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // --- INIT ---
        window.onload = function() {
            initThreeJS();
            loadData();
        };

    </script>
</body>
</html>
